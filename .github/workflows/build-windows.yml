name: Build Windows Exe

# è§¦å‘æ¡ä»¶ï¼šå½“ä½ æ¨é€åˆ° main åˆ†æ”¯ï¼Œæˆ–è€…æ‰‹åŠ¨ç‚¹å‡»è§¦å‘
on:
  push:
    branches: [ main ]
  workflow_dispatch: # å…è®¸ä½ åœ¨ GitHub ç½‘é¡µä¸Šæ‰‹åŠ¨ç‚¹æŒ‰é’®è§¦å‘

jobs:
  build-win:
    runs-on: windows-latest # ğŸ‘ˆ å…³é”®ï¼ä½¿ç”¨ GitHub æä¾›çš„ Windows ç”µè„‘è¿è¡Œ

    steps:
      # 1. æ‹‰å–ä»£ç 
      - name: Check out Git repository
        uses: actions/checkout@v4

      # 2. å®‰è£… Node.js (æ¨è v18 æˆ– v20)
      - name: Install Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm' # è‡ªåŠ¨ç¼“å­˜ npm ä¾èµ–ï¼ŒåŠ å¿«æ„å»ºé€Ÿåº¦

      # 3. å®‰è£…ä¾èµ–
      - name: Install Dependencies
        run: npm install

      # 4. æ„å»º Vue é¡µé¢ (ç”Ÿæˆ dist ç›®å½•)
      - name: Build Vue App
        run: npm run build

      # 5. æ‰“åŒ… Electron (ç”Ÿæˆ exe)
      # æ³¨æ„ï¼šè¿™é‡Œç›´æ¥ç”¨ npx å¼ºåˆ¶æŒ‡å®šæ‰“åŒ… windowsï¼Œé˜²æ­¢è„šæœ¬é”™ä¹±
      - name: Build Electron App
        run: npx electron-builder --win --x64
        env:
          # å¦‚æœéœ€è¦å‘å¸ƒåˆ° Releaseï¼Œéœ€è¦è¿™ä¸ª Tokenï¼ˆGitHub è‡ªåŠ¨æä¾›ï¼Œä¸ç”¨ä½ è‡ªå·±å¡«ï¼‰
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # 6. ä¸Šä¼ æ‰“åŒ…ç»“æœ (æŠŠ exe å­˜èµ·æ¥ä¾›ä½ ä¸‹è½½)
      - name: Upload Artifacts
        uses: actions/upload-artifact@v4
        with:
          name: Windows-App
          # è¿™é‡Œçš„è·¯å¾„è¦å’Œä½  package.json é…ç½®çš„ output ç›®å½•ä¸€è‡´
          path: release/*.exe
          retention-days: 5 # æ–‡ä»¶ä¿ç•™ 5 å¤©